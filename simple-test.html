<!DOCTYPE html>
<html>
<head>
    <title>Google API ìµœì†Œ í…ŒìŠ¤íŠ¸</title>
</head>
<body>
    <h1>Google API ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸</h1>
    <div id="status">ì¤€ë¹„ë¨ - í…ŒìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
    
    <div style="margin: 20px 0;">
        <h3>ì¸ì¦ í…ŒìŠ¤íŠ¸:</h3>
        <button onclick="testOldWay()" style="margin: 5px; padding: 10px;">1. ê¸°ì¡´ ë°©ì‹ (gapi.auth2)</button><br>
        <button onclick="testNewWay()" style="margin: 5px; padding: 10px;">2. ìƒˆë¡œìš´ ë°©ì‹ (Google Identity Services) âœ…</button><br>
        <button onclick="testInit()" style="margin: 5px; padding: 10px;">3. ë‘˜ ë‹¤ í…ŒìŠ¤íŠ¸</button>
    </div>
    
    <div style="margin: 20px 0; padding: 15px; border: 2px solid #4CAF50; border-radius: 8px; background: #f0f8f0;">
        <h3>ğŸ‰ ì¸ì¦ ì„±ê³µ! ì´ì œ íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì„¸ìš”:</h3>
        <input type="file" id="fileInput" accept="image/*,video/*" style="margin: 10px 0;">
        <button onclick="uploadFile()" style="margin: 5px; padding: 10px; background: #4CAF50; color: white;">íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
        <div id="uploadStatus" style="margin: 10px 0; font-weight: bold;"></div>
    </div>
    
    <!-- Google Identity Services ìƒˆë¡œìš´ ë°©ì‹ -->
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const CLIENT_ID = '201175895307-8au0ct74b8d78mlae58mdm7noddabjvm.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyAY4DHjJkDmVklkxXT3TXtorayCd3XPccI';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        
        let tokenClient;
        let accessToken = null;
        
        // Google Identity Services ì´ˆê¸°í™”
        function initializeGIS() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: (tokenResponse) => {
                    accessToken = tokenResponse.access_token;
                    console.log('âœ… í† í° íšë“ ì„±ê³µ:', tokenResponse);
                    document.getElementById('status').innerHTML = 'âœ… ì¸ì¦ ì„±ê³µ! í† í° íšë“ë¨';
                },
            });
            console.log('âœ… Google Identity Services ì´ˆê¸°í™” ì™„ë£Œ');
        }
        
        // ê¸°ì¡´ ë°©ì‹ (gapi.auth2) í…ŒìŠ¤íŠ¸
        function testOldWay() {
            document.getElementById('status').innerHTML = 'â³ ê¸°ì¡´ ë°©ì‹ í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            gapi.load('client:auth2', async () => {
                try {
                    await gapi.client.init({
                        apiKey: API_KEY,
                        clientId: CLIENT_ID,
                        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                        scope: SCOPES
                    });
                    
                    document.getElementById('status').innerHTML = 'âœ… ê¸°ì¡´ ë°©ì‹ ì„±ê³µ!';
                    console.log('âœ… ê¸°ì¡´ ë°©ì‹ ì„±ê³µ');
                    
                } catch (error) {
                    document.getElementById('status').innerHTML = `âŒ ê¸°ì¡´ ë°©ì‹ ì‹¤íŒ¨: ${error.error}`;
                    console.error('âŒ ê¸°ì¡´ ë°©ì‹ ì‹¤íŒ¨:', error);
                }
            });
        }
        
        // ìƒˆë¡œìš´ ë°©ì‹ (Google Identity Services) í…ŒìŠ¤íŠ¸
        function testNewWay() {
            document.getElementById('status').innerHTML = 'â³ ìƒˆë¡œìš´ ë°©ì‹ í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            // Google API í´ë¼ì´ì–¸íŠ¸ë§Œ ì´ˆê¸°í™” (ì¸ì¦ ì—†ì´)
            gapi.load('client', async () => {
                try {
                    await gapi.client.init({
                        apiKey: API_KEY,
                        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']
                    });
                    
                    console.log('âœ… API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì„±ê³µ');
                    
                    // í† í° ìš”ì²­
                    if (tokenClient) {
                        tokenClient.requestAccessToken();
                    } else {
                        document.getElementById('status').innerHTML = 'âŒ í† í° í´ë¼ì´ì–¸íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ';
                    }
                    
                } catch (error) {
                    document.getElementById('status').innerHTML = `âŒ ìƒˆë¡œìš´ ë°©ì‹ ì‹¤íŒ¨: ${error.message}`;
                    console.error('âŒ ìƒˆë¡œìš´ ë°©ì‹ ì‹¤íŒ¨:', error);
                }
            });
        }
        
        // í†µí•© í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        function testInit() {
            console.log('ğŸŒ í˜„ì¬ Origin:', window.location.origin);
            console.log('ğŸ”‘ Client ID:', CLIENT_ID);
            
            // ë‘˜ ë‹¤ ì‹œë„
            console.log('ğŸ“‹ 1. ê¸°ì¡´ ë°©ì‹ ì‹œë„...');
            setTimeout(() => {
                console.log('ğŸ“‹ 2. ìƒˆë¡œìš´ ë°©ì‹ ì‹œë„...');
                testNewWay();
            }, 3000);
            
            testOldWay();
        }
        
        // íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const uploadStatus = document.getElementById('uploadStatus');
            const file = fileInput.files[0];
            
            if (!file) {
                uploadStatus.innerHTML = 'âŒ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
                return;
            }
            
            if (!accessToken) {
                uploadStatus.innerHTML = 'âŒ ë¨¼ì € ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš” (ìƒˆë¡œìš´ ë°©ì‹ ë²„íŠ¼ í´ë¦­)';
                return;
            }
            
            uploadStatus.innerHTML = 'â³ ì—…ë¡œë“œ ì¤‘...';
            
            try {
                console.log('ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘:', file.name);
                
                // Google Drive APIë¥¼ ì‚¬ìš©í•œ íŒŒì¼ ì—…ë¡œë“œ
                const metadata = {
                    'name': file.name,
                    'parents': ['1gei84cTcsgRheWIyhGuqPLX4DZcXTJkb'] // Blog Data í´ë” ID
                };
                
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
                form.append('file', file);
                
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,name,webViewLink', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    },
                    body: form
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('âœ… ì—…ë¡œë“œ ì„±ê³µ:', result);
                
                // íŒŒì¼ì„ ê³µê°œë¡œ ì„¤ì •
                await makeFilePublic(result.id);
                
                const publicUrl = `https://drive.google.com/uc?id=${result.id}`;
                
                uploadStatus.innerHTML = `
                    âœ… ì—…ë¡œë“œ ì„±ê³µ!<br>
                    <small>íŒŒì¼ëª…: ${result.name}</small><br>
                    <small>ID: ${result.id}</small><br>
                    <small><a href="${publicUrl}" target="_blank">ê³µê°œ URL</a></small>
                `;
                
            } catch (error) {
                console.error('âŒ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                uploadStatus.innerHTML = `âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${error.message}`;
            }
        }
        
        // íŒŒì¼ì„ ê³µê°œë¡œ ì„¤ì •
        async function makeFilePublic(fileId) {
            try {
                await fetch(`https://www.googleapis.com/drive/v3/files/${fileId}/permissions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        'role': 'reader',
                        'type': 'anyone'
                    })
                });
                console.log('âœ… íŒŒì¼ ê³µê°œ ì„¤ì • ì™„ë£Œ');
            } catch (error) {
                console.warn('âš ï¸ íŒŒì¼ ê³µê°œ ì„¤ì • ì‹¤íŒ¨:', error);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ GIS ì´ˆê¸°í™”
        window.onload = () => {
            initializeGIS();
        };
        
        // í˜ì´ì§€ ë¡œë“œì‹œ í˜„ì¬ URL í‘œì‹œ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('í˜„ì¬ URL:', window.location.href);
            console.log('í˜„ì¬ Origin:', window.location.origin);
        });
    </script>
</body>
</html>